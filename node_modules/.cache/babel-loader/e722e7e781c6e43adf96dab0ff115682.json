{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime-corejs3/helpers/interopRequireDefault\");\n\nvar _getIterator2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js/get-iterator\"));\n\nvar _isArray = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/array/is-array\"));\n\nvar _getIteratorMethod2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js/get-iterator-method\"));\n\nvar _symbol = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/symbol\"));\n\nvar _from = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/array/from\"));\n\nvar _slice = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/slice\"));\n\nvar _map = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/map\"));\n\nvar _promise = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/promise\"));\n\nvar _reduce = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/reduce\"));\n\nvar _stringify = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/json/stringify\"));\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime-corejs3/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/asyncToGenerator\"));\n\nvar _LocalDatastoreUtils = require(\"./LocalDatastoreUtils\");\n\nvar _Storage = _interopRequireDefault(require(\"./Storage\"));\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) {\n  var it;\n\n  if (typeof _symbol.default === \"undefined\" || (0, _getIteratorMethod2.default)(o) == null) {\n    if ((0, _isArray.default)(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n\n      var F = function F() {};\n\n      return {\n        s: F,\n        n: function n() {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function e(_e) {\n          throw _e;\n        },\n        f: F\n      };\n    }\n\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n\n  var normalCompletion = true,\n      didErr = false,\n      err;\n  return {\n    s: function s() {\n      it = (0, _getIterator2.default)(o);\n    },\n    n: function n() {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function e(_e2) {\n      didErr = true;\n      err = _e2;\n    },\n    f: function f() {\n      try {\n        if (!normalCompletion && it.return != null) it.return();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  var _context7;\n\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = (0, _slice.default)(_context7 = Object.prototype.toString.call(o)).call(_context7, 8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return (0, _from.default)(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nvar LocalDatastoreController = {\n  fromPinWithName: function fromPinWithName(name\n  /*: string*/\n  )\n  /*: Array<Object>*/\n  {\n    return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee() {\n      var values, objects;\n      return _regenerator.default.wrap(function (_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _Storage.default.getItemAsync(name);\n\n            case 2:\n              values = _context.sent;\n\n              if (values) {\n                _context.next = 5;\n                break;\n              }\n\n              return _context.abrupt(\"return\", []);\n\n            case 5:\n              objects = JSON.parse(values);\n              return _context.abrupt(\"return\", objects);\n\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }))();\n  },\n  pinWithName: function pinWithName(name\n  /*: string*/\n  , value\n  /*: any*/\n  ) {\n    var values = (0, _stringify.default)(value);\n    return _Storage.default.setItemAsync(name, values);\n  },\n  unPinWithName: function unPinWithName(name\n  /*: string*/\n  ) {\n    return _Storage.default.removeItemAsync(name);\n  },\n  getAllContents: function getAllContents()\n  /*: Object*/\n  {\n    return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee3() {\n      var keys;\n      return _regenerator.default.wrap(function (_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return _Storage.default.getAllKeysAsync();\n\n            case 2:\n              keys = _context3.sent;\n              return _context3.abrupt(\"return\", (0, _reduce.default)(keys).call(keys, /*#__PURE__*/function () {\n                var _ref = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee2(previousPromise, key) {\n                  var LDS, value;\n                  return _regenerator.default.wrap(function (_context2) {\n                    while (1) {\n                      switch (_context2.prev = _context2.next) {\n                        case 0:\n                          _context2.next = 2;\n                          return previousPromise;\n\n                        case 2:\n                          LDS = _context2.sent;\n\n                          if (!(0, _LocalDatastoreUtils.isLocalDatastoreKey)(key)) {\n                            _context2.next = 8;\n                            break;\n                          }\n\n                          _context2.next = 6;\n                          return _Storage.default.getItemAsync(key);\n\n                        case 6:\n                          value = _context2.sent;\n\n                          try {\n                            LDS[key] = JSON.parse(value);\n                          } catch (error) {\n                            console.error('Error getAllContents: ', error);\n                          }\n\n                        case 8:\n                          return _context2.abrupt(\"return\", LDS);\n\n                        case 9:\n                        case \"end\":\n                          return _context2.stop();\n                      }\n                    }\n                  }, _callee2);\n                }));\n\n                return function () {\n                  return _ref.apply(this, arguments);\n                };\n              }(), _promise.default.resolve({})));\n\n            case 4:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }))();\n  },\n  // Used for testing\n  getRawStorage: function getRawStorage()\n  /*: Object*/\n  {\n    return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee5() {\n      var keys;\n      return _regenerator.default.wrap(function (_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.next = 2;\n              return _Storage.default.getAllKeysAsync();\n\n            case 2:\n              keys = _context5.sent;\n              return _context5.abrupt(\"return\", (0, _reduce.default)(keys).call(keys, /*#__PURE__*/function () {\n                var _ref2 = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee4(previousPromise, key) {\n                  var LDS, value;\n                  return _regenerator.default.wrap(function (_context4) {\n                    while (1) {\n                      switch (_context4.prev = _context4.next) {\n                        case 0:\n                          _context4.next = 2;\n                          return previousPromise;\n\n                        case 2:\n                          LDS = _context4.sent;\n                          _context4.next = 5;\n                          return _Storage.default.getItemAsync(key);\n\n                        case 5:\n                          value = _context4.sent;\n                          LDS[key] = value;\n                          return _context4.abrupt(\"return\", LDS);\n\n                        case 8:\n                        case \"end\":\n                          return _context4.stop();\n                      }\n                    }\n                  }, _callee4);\n                }));\n\n                return function () {\n                  return _ref2.apply(this, arguments);\n                };\n              }(), _promise.default.resolve({})));\n\n            case 4:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5);\n    }))();\n  },\n  clear: function clear()\n  /*: Promise*/\n  {\n    var _this = this;\n\n    return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee6() {\n      var keys, toRemove, _iterator, _step, key, promises;\n\n      return _regenerator.default.wrap(function (_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              _context6.next = 2;\n              return _Storage.default.getAllKeysAsync();\n\n            case 2:\n              keys = _context6.sent;\n              toRemove = [];\n              _iterator = _createForOfIteratorHelper(keys);\n\n              try {\n                for (_iterator.s(); !(_step = _iterator.n()).done;) {\n                  key = _step.value;\n\n                  if ((0, _LocalDatastoreUtils.isLocalDatastoreKey)(key)) {\n                    toRemove.push(key);\n                  }\n                }\n              } catch (err) {\n                _iterator.e(err);\n              } finally {\n                _iterator.f();\n              }\n\n              promises = (0, _map.default)(toRemove).call(toRemove, _this.unPinWithName);\n              return _context6.abrupt(\"return\", _promise.default.all(promises));\n\n            case 8:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, _callee6);\n    }))();\n  }\n};\nmodule.exports = LocalDatastoreController;","map":{"version":3,"sources":["/Users/angelvazquez/Dropbox/My Mac (Angels-MacBook-Pro-4.local)/Documents/Projects/Murmuration - 10:04:2021/node_modules/parse/lib/browser/LocalDatastoreController.js"],"names":["_interopRequireDefault","require","_getIterator2","_isArray","_getIteratorMethod2","_symbol","_from","_slice","_map","_promise","_reduce","_stringify","_regenerator","_asyncToGenerator2","_LocalDatastoreUtils","_Storage","_createForOfIteratorHelper","o","allowArrayLike","it","default","_unsupportedIterableToArray","length","i","F","s","n","done","value","e","_e","f","TypeError","normalCompletion","didErr","err","step","next","_e2","return","minLen","_context7","_arrayLikeToArray","Object","prototype","toString","call","constructor","name","test","arr","len","arr2","Array","LocalDatastoreController","fromPinWithName","mark","_callee","values","objects","wrap","_context","prev","getItemAsync","sent","abrupt","JSON","parse","stop","pinWithName","setItemAsync","unPinWithName","removeItemAsync","getAllContents","_callee3","keys","_context3","getAllKeysAsync","_ref","_callee2","previousPromise","key","LDS","_context2","isLocalDatastoreKey","error","console","apply","arguments","resolve","getRawStorage","_callee5","_context5","_ref2","_callee4","_context4","clear","_this","_callee6","toRemove","_iterator","_step","promises","_context6","push","all","module","exports"],"mappings":"AAAA;;AAEA,IAAIA,sBAAsB,GAAGC,OAAO,CAAC,sDAAD,CAApC;;AAEA,IAAIC,aAAa,GAAGF,sBAAsB,CAACC,OAAO,CAAC,6CAAD,CAAR,CAA1C;;AAEA,IAAIE,QAAQ,GAAGH,sBAAsB,CAACC,OAAO,CAAC,sDAAD,CAAR,CAArC;;AAEA,IAAIG,mBAAmB,GAAGJ,sBAAsB,CAACC,OAAO,CAAC,oDAAD,CAAR,CAAhD;;AAEA,IAAII,OAAO,GAAGL,sBAAsB,CAACC,OAAO,CAAC,8CAAD,CAAR,CAApC;;AAEA,IAAIK,KAAK,GAAGN,sBAAsB,CAACC,OAAO,CAAC,kDAAD,CAAR,CAAlC;;AAEA,IAAIM,MAAM,GAAGP,sBAAsB,CAACC,OAAO,CAAC,sDAAD,CAAR,CAAnC;;AAEA,IAAIO,IAAI,GAAGR,sBAAsB,CAACC,OAAO,CAAC,oDAAD,CAAR,CAAjC;;AAEA,IAAIQ,QAAQ,GAAGT,sBAAsB,CAACC,OAAO,CAAC,+CAAD,CAAR,CAArC;;AAEA,IAAIS,OAAO,GAAGV,sBAAsB,CAACC,OAAO,CAAC,uDAAD,CAAR,CAApC;;AAEA,IAAIU,UAAU,GAAGX,sBAAsB,CAACC,OAAO,CAAC,sDAAD,CAAR,CAAvC;;AAEA,IAAIW,YAAY,GAAGZ,sBAAsB,CAACC,OAAO,CAAC,oCAAD,CAAR,CAAzC;;AAEA,IAAIY,kBAAkB,GAAGb,sBAAsB,CAACC,OAAO,CAAC,iDAAD,CAAR,CAA/C;;AAEA,IAAIa,oBAAoB,GAAGb,OAAO,CAAC,uBAAD,CAAlC;;AAEA,IAAIc,QAAQ,GAAGf,sBAAsB,CAACC,OAAO,CAAC,WAAD,CAAR,CAArC;;AAEA,SAASe,0BAAT,CAAoCC,CAApC,EAAuCC,cAAvC,EAAuD;AACrD,MAAIC,EAAJ;;AAEA,MAAI,OAAOd,OAAO,CAACe,OAAf,KAA2B,WAA3B,IAA0C,CAAC,GAAGhB,mBAAmB,CAACgB,OAAxB,EAAiCH,CAAjC,KAAuC,IAArF,EAA2F;AACzF,QAAI,CAAC,GAAGd,QAAQ,CAACiB,OAAb,EAAsBH,CAAtB,MAA6BE,EAAE,GAAGE,2BAA2B,CAACJ,CAAD,CAA7D,KAAqEC,cAAc,IAAID,CAAlB,IAAuB,OAAOA,CAAC,CAACK,MAAT,KAAoB,QAApH,EAA8H;AAC5H,UAAIH,EAAJ,EAAQF,CAAC,GAAGE,EAAJ;AACR,UAAII,CAAC,GAAG,CAAR;;AAEA,UAAIC,CAAC,GAAG,SAAJA,CAAI,GAAY,CAAE,CAAtB;;AAEA,aAAO;AACLC,QAAAA,CAAC,EAAED,CADE;AAELE,QAAAA,CAAC,EAAE,aAAY;AACb,cAAIH,CAAC,IAAIN,CAAC,CAACK,MAAX,EAAmB,OAAO;AACxBK,YAAAA,IAAI,EAAE;AADkB,WAAP;AAGnB,iBAAO;AACLA,YAAAA,IAAI,EAAE,KADD;AAELC,YAAAA,KAAK,EAAEX,CAAC,CAACM,CAAC,EAAF;AAFH,WAAP;AAID,SAVI;AAWLM,QAAAA,CAAC,EAAE,WAAUC,EAAV,EAAc;AACf,gBAAMA,EAAN;AACD,SAbI;AAcLC,QAAAA,CAAC,EAAEP;AAdE,OAAP;AAgBD;;AAED,UAAM,IAAIQ,SAAJ,CAAc,uIAAd,CAAN;AACD;;AAED,MAAIC,gBAAgB,GAAG,IAAvB;AAAA,MACIC,MAAM,GAAG,KADb;AAAA,MAEIC,GAFJ;AAGA,SAAO;AACLV,IAAAA,CAAC,EAAE,aAAY;AACbN,MAAAA,EAAE,GAAG,CAAC,GAAGjB,aAAa,CAACkB,OAAlB,EAA2BH,CAA3B,CAAL;AACD,KAHI;AAILS,IAAAA,CAAC,EAAE,aAAY;AACb,UAAIU,IAAI,GAAGjB,EAAE,CAACkB,IAAH,EAAX;AACAJ,MAAAA,gBAAgB,GAAGG,IAAI,CAACT,IAAxB;AACA,aAAOS,IAAP;AACD,KARI;AASLP,IAAAA,CAAC,EAAE,WAAUS,GAAV,EAAe;AAChBJ,MAAAA,MAAM,GAAG,IAAT;AACAC,MAAAA,GAAG,GAAGG,GAAN;AACD,KAZI;AAaLP,IAAAA,CAAC,EAAE,aAAY;AACb,UAAI;AACF,YAAI,CAACE,gBAAD,IAAqBd,EAAE,CAACoB,MAAH,IAAa,IAAtC,EAA4CpB,EAAE,CAACoB,MAAH;AAC7C,OAFD,SAEU;AACR,YAAIL,MAAJ,EAAY,MAAMC,GAAN;AACb;AACF;AAnBI,GAAP;AAqBD;;AAED,SAASd,2BAAT,CAAqCJ,CAArC,EAAwCuB,MAAxC,EAAgD;AAC9C,MAAIC,SAAJ;;AAEA,MAAI,CAACxB,CAAL,EAAQ;AACR,MAAI,OAAOA,CAAP,KAAa,QAAjB,EAA2B,OAAOyB,iBAAiB,CAACzB,CAAD,EAAIuB,MAAJ,CAAxB;AAC3B,MAAId,CAAC,GAAG,CAAC,GAAGnB,MAAM,CAACa,OAAX,EAAoBqB,SAAS,GAAGE,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+B7B,CAA/B,CAAhC,EAAmE6B,IAAnE,CAAwEL,SAAxE,EAAmF,CAAnF,EAAsF,CAAC,CAAvF,CAAR;AACA,MAAIf,CAAC,KAAK,QAAN,IAAkBT,CAAC,CAAC8B,WAAxB,EAAqCrB,CAAC,GAAGT,CAAC,CAAC8B,WAAF,CAAcC,IAAlB;AACrC,MAAItB,CAAC,KAAK,KAAN,IAAeA,CAAC,KAAK,KAAzB,EAAgC,OAAO,CAAC,GAAGpB,KAAK,CAACc,OAAV,EAAmBH,CAAnB,CAAP;AAChC,MAAIS,CAAC,KAAK,WAAN,IAAqB,2CAA2CuB,IAA3C,CAAgDvB,CAAhD,CAAzB,EAA6E,OAAOgB,iBAAiB,CAACzB,CAAD,EAAIuB,MAAJ,CAAxB;AAC9E;;AAED,SAASE,iBAAT,CAA2BQ,GAA3B,EAAgCC,GAAhC,EAAqC;AACnC,MAAIA,GAAG,IAAI,IAAP,IAAeA,GAAG,GAAGD,GAAG,CAAC5B,MAA7B,EAAqC6B,GAAG,GAAGD,GAAG,CAAC5B,MAAV;;AAErC,OAAK,IAAIC,CAAC,GAAG,CAAR,EAAW6B,IAAI,GAAG,IAAIC,KAAJ,CAAUF,GAAV,CAAvB,EAAuC5B,CAAC,GAAG4B,GAA3C,EAAgD5B,CAAC,EAAjD,EAAqD;AACnD6B,IAAAA,IAAI,CAAC7B,CAAD,CAAJ,GAAU2B,GAAG,CAAC3B,CAAD,CAAb;AACD;;AAED,SAAO6B,IAAP;AACD;;AAED,IAAIE,wBAAwB,GAAG;AAC7BC,EAAAA,eAAe,EAAE,yBAAUP;AAC3B;AADiB;AAGjB;AACA;AACE,WAAO,CAAC,GAAGnC,kBAAkB,CAACO,OAAvB,GAAiC,aAAaR,YAAY,CAACQ,OAAb,CAAqBoC,IAArB,CAA0B,SAASC,OAAT,GAAmB;AAChG,UAAIC,MAAJ,EAAYC,OAAZ;AACA,aAAO/C,YAAY,CAACQ,OAAb,CAAqBwC,IAArB,CAA0B,UAAUC,QAAV,EAAoB;AACnD,eAAO,CAAP,EAAU;AACR,kBAAQA,QAAQ,CAACC,IAAT,GAAgBD,QAAQ,CAACxB,IAAjC;AACE,iBAAK,CAAL;AACEwB,cAAAA,QAAQ,CAACxB,IAAT,GAAgB,CAAhB;AACA,qBAAOtB,QAAQ,CAACK,OAAT,CAAiB2C,YAAjB,CAA8Bf,IAA9B,CAAP;;AAEF,iBAAK,CAAL;AACEU,cAAAA,MAAM,GAAGG,QAAQ,CAACG,IAAlB;;AAEA,kBAAIN,MAAJ,EAAY;AACVG,gBAAAA,QAAQ,CAACxB,IAAT,GAAgB,CAAhB;AACA;AACD;;AAED,qBAAOwB,QAAQ,CAACI,MAAT,CAAgB,QAAhB,EAA0B,EAA1B,CAAP;;AAEF,iBAAK,CAAL;AACEN,cAAAA,OAAO,GAAGO,IAAI,CAACC,KAAL,CAAWT,MAAX,CAAV;AACA,qBAAOG,QAAQ,CAACI,MAAT,CAAgB,QAAhB,EAA0BN,OAA1B,CAAP;;AAEF,iBAAK,CAAL;AACA,iBAAK,KAAL;AACE,qBAAOE,QAAQ,CAACO,IAAT,EAAP;AArBJ;AAuBD;AACF,OA1BM,EA0BJX,OA1BI,CAAP;AA2BD,KA7BoD,CAA9C,GAAP;AA8BD,GApC4B;AAqC7BY,EAAAA,WAAW,EAAE,qBAAUrB;AACvB;AADa,IAEXpB;AACF;AAHa,IAIX;AACA,QAAI8B,MAAM,GAAG,CAAC,GAAG/C,UAAU,CAACS,OAAf,EAAwBQ,KAAxB,CAAb;AACA,WAAOb,QAAQ,CAACK,OAAT,CAAiBkD,YAAjB,CAA8BtB,IAA9B,EAAoCU,MAApC,CAAP;AACD,GA5C4B;AA6C7Ba,EAAAA,aAAa,EAAE,uBAAUvB;AACzB;AADe,IAEb;AACA,WAAOjC,QAAQ,CAACK,OAAT,CAAiBoD,eAAjB,CAAiCxB,IAAjC,CAAP;AACD,GAjD4B;AAkD7ByB,EAAAA,cAAc,EAAE;AAChB;AACA;AACE,WAAO,CAAC,GAAG5D,kBAAkB,CAACO,OAAvB,GAAiC,aAAaR,YAAY,CAACQ,OAAb,CAAqBoC,IAArB,CAA0B,SAASkB,QAAT,GAAoB;AACjG,UAAIC,IAAJ;AACA,aAAO/D,YAAY,CAACQ,OAAb,CAAqBwC,IAArB,CAA0B,UAAUgB,SAAV,EAAqB;AACpD,eAAO,CAAP,EAAU;AACR,kBAAQA,SAAS,CAACd,IAAV,GAAiBc,SAAS,CAACvC,IAAnC;AACE,iBAAK,CAAL;AACEuC,cAAAA,SAAS,CAACvC,IAAV,GAAiB,CAAjB;AACA,qBAAOtB,QAAQ,CAACK,OAAT,CAAiByD,eAAjB,EAAP;;AAEF,iBAAK,CAAL;AACEF,cAAAA,IAAI,GAAGC,SAAS,CAACZ,IAAjB;AACA,qBAAOY,SAAS,CAACX,MAAV,CAAiB,QAAjB,EAA2B,CAAC,GAAGvD,OAAO,CAACU,OAAZ,EAAqBuD,IAArB,EAA2B7B,IAA3B,CAAgC6B,IAAhC,EAAsC,aAAa,YAAY;AAC/F,oBAAIG,IAAI,GAAG,CAAC,GAAGjE,kBAAkB,CAACO,OAAvB,GAAiC,aAAaR,YAAY,CAACQ,OAAb,CAAqBoC,IAArB,CAA0B,SAASuB,QAAT,CAAkBC,eAAlB,EAAmCC,GAAnC,EAAwC;AACzH,sBAAIC,GAAJ,EAAStD,KAAT;AACA,yBAAOhB,YAAY,CAACQ,OAAb,CAAqBwC,IAArB,CAA0B,UAAUuB,SAAV,EAAqB;AACpD,2BAAO,CAAP,EAAU;AACR,8BAAQA,SAAS,CAACrB,IAAV,GAAiBqB,SAAS,CAAC9C,IAAnC;AACE,6BAAK,CAAL;AACE8C,0BAAAA,SAAS,CAAC9C,IAAV,GAAiB,CAAjB;AACA,iCAAO2C,eAAP;;AAEF,6BAAK,CAAL;AACEE,0BAAAA,GAAG,GAAGC,SAAS,CAACnB,IAAhB;;AAEA,8BAAI,CAAC,CAAC,GAAGlD,oBAAoB,CAACsE,mBAAzB,EAA8CH,GAA9C,CAAL,EAAyD;AACvDE,4BAAAA,SAAS,CAAC9C,IAAV,GAAiB,CAAjB;AACA;AACD;;AAED8C,0BAAAA,SAAS,CAAC9C,IAAV,GAAiB,CAAjB;AACA,iCAAOtB,QAAQ,CAACK,OAAT,CAAiB2C,YAAjB,CAA8BkB,GAA9B,CAAP;;AAEF,6BAAK,CAAL;AACErD,0BAAAA,KAAK,GAAGuD,SAAS,CAACnB,IAAlB;;AAEA,8BAAI;AACFkB,4BAAAA,GAAG,CAACD,GAAD,CAAH,GAAWf,IAAI,CAACC,KAAL,CAAWvC,KAAX,CAAX;AACD,2BAFD,CAEE,OAAOyD,KAAP,EAAc;AACdC,4BAAAA,OAAO,CAACD,KAAR,CAAc,wBAAd,EAAwCA,KAAxC;AACD;;AAEH,6BAAK,CAAL;AACE,iCAAOF,SAAS,CAAClB,MAAV,CAAiB,QAAjB,EAA2BiB,GAA3B,CAAP;;AAEF,6BAAK,CAAL;AACA,6BAAK,KAAL;AACE,iCAAOC,SAAS,CAACf,IAAV,EAAP;AA9BJ;AAgCD;AACF,mBAnCM,EAmCJW,QAnCI,CAAP;AAoCD,iBAtCwD,CAA9C,CAAX;;AAwCA,uBAAO,YAAY;AACjB,yBAAOD,IAAI,CAACS,KAAL,CAAW,IAAX,EAAiBC,SAAjB,CAAP;AACD,iBAFD;AAGD,eA5CoF,EAAnD,EA4C7B/E,QAAQ,CAACW,OAAT,CAAiBqE,OAAjB,CAAyB,EAAzB,CA5C6B,CAA3B,CAAP;;AA8CF,iBAAK,CAAL;AACA,iBAAK,KAAL;AACE,qBAAOb,SAAS,CAACR,IAAV,EAAP;AAvDJ;AAyDD;AACF,OA5DM,EA4DJM,QA5DI,CAAP;AA6DD,KA/DoD,CAA9C,GAAP;AAgED,GArH4B;AAsH7B;AACAgB,EAAAA,aAAa,EAAE;AACf;AACA;AACE,WAAO,CAAC,GAAG7E,kBAAkB,CAACO,OAAvB,GAAiC,aAAaR,YAAY,CAACQ,OAAb,CAAqBoC,IAArB,CAA0B,SAASmC,QAAT,GAAoB;AACjG,UAAIhB,IAAJ;AACA,aAAO/D,YAAY,CAACQ,OAAb,CAAqBwC,IAArB,CAA0B,UAAUgC,SAAV,EAAqB;AACpD,eAAO,CAAP,EAAU;AACR,kBAAQA,SAAS,CAAC9B,IAAV,GAAiB8B,SAAS,CAACvD,IAAnC;AACE,iBAAK,CAAL;AACEuD,cAAAA,SAAS,CAACvD,IAAV,GAAiB,CAAjB;AACA,qBAAOtB,QAAQ,CAACK,OAAT,CAAiByD,eAAjB,EAAP;;AAEF,iBAAK,CAAL;AACEF,cAAAA,IAAI,GAAGiB,SAAS,CAAC5B,IAAjB;AACA,qBAAO4B,SAAS,CAAC3B,MAAV,CAAiB,QAAjB,EAA2B,CAAC,GAAGvD,OAAO,CAACU,OAAZ,EAAqBuD,IAArB,EAA2B7B,IAA3B,CAAgC6B,IAAhC,EAAsC,aAAa,YAAY;AAC/F,oBAAIkB,KAAK,GAAG,CAAC,GAAGhF,kBAAkB,CAACO,OAAvB,GAAiC,aAAaR,YAAY,CAACQ,OAAb,CAAqBoC,IAArB,CAA0B,SAASsC,QAAT,CAAkBd,eAAlB,EAAmCC,GAAnC,EAAwC;AAC1H,sBAAIC,GAAJ,EAAStD,KAAT;AACA,yBAAOhB,YAAY,CAACQ,OAAb,CAAqBwC,IAArB,CAA0B,UAAUmC,SAAV,EAAqB;AACpD,2BAAO,CAAP,EAAU;AACR,8BAAQA,SAAS,CAACjC,IAAV,GAAiBiC,SAAS,CAAC1D,IAAnC;AACE,6BAAK,CAAL;AACE0D,0BAAAA,SAAS,CAAC1D,IAAV,GAAiB,CAAjB;AACA,iCAAO2C,eAAP;;AAEF,6BAAK,CAAL;AACEE,0BAAAA,GAAG,GAAGa,SAAS,CAAC/B,IAAhB;AACA+B,0BAAAA,SAAS,CAAC1D,IAAV,GAAiB,CAAjB;AACA,iCAAOtB,QAAQ,CAACK,OAAT,CAAiB2C,YAAjB,CAA8BkB,GAA9B,CAAP;;AAEF,6BAAK,CAAL;AACErD,0BAAAA,KAAK,GAAGmE,SAAS,CAAC/B,IAAlB;AACAkB,0BAAAA,GAAG,CAACD,GAAD,CAAH,GAAWrD,KAAX;AACA,iCAAOmE,SAAS,CAAC9B,MAAV,CAAiB,QAAjB,EAA2BiB,GAA3B,CAAP;;AAEF,6BAAK,CAAL;AACA,6BAAK,KAAL;AACE,iCAAOa,SAAS,CAAC3B,IAAV,EAAP;AAjBJ;AAmBD;AACF,mBAtBM,EAsBJ0B,QAtBI,CAAP;AAuBD,iBAzByD,CAA9C,CAAZ;;AA2BA,uBAAO,YAAY;AACjB,yBAAOD,KAAK,CAACN,KAAN,CAAY,IAAZ,EAAkBC,SAAlB,CAAP;AACD,iBAFD;AAGD,eA/BoF,EAAnD,EA+B7B/E,QAAQ,CAACW,OAAT,CAAiBqE,OAAjB,CAAyB,EAAzB,CA/B6B,CAA3B,CAAP;;AAiCF,iBAAK,CAAL;AACA,iBAAK,KAAL;AACE,qBAAOG,SAAS,CAACxB,IAAV,EAAP;AA1CJ;AA4CD;AACF,OA/CM,EA+CJuB,QA/CI,CAAP;AAgDD,KAlDoD,CAA9C,GAAP;AAmDD,GA7K4B;AA8K7BK,EAAAA,KAAK,EAAE;AACP;AACA;AACE,QAAIC,KAAK,GAAG,IAAZ;;AAEA,WAAO,CAAC,GAAGpF,kBAAkB,CAACO,OAAvB,GAAiC,aAAaR,YAAY,CAACQ,OAAb,CAAqBoC,IAArB,CAA0B,SAAS0C,QAAT,GAAoB;AACjG,UAAIvB,IAAJ,EAAUwB,QAAV,EAAoBC,SAApB,EAA+BC,KAA/B,EAAsCpB,GAAtC,EAA2CqB,QAA3C;;AAEA,aAAO1F,YAAY,CAACQ,OAAb,CAAqBwC,IAArB,CAA0B,UAAU2C,SAAV,EAAqB;AACpD,eAAO,CAAP,EAAU;AACR,kBAAQA,SAAS,CAACzC,IAAV,GAAiByC,SAAS,CAAClE,IAAnC;AACE,iBAAK,CAAL;AACEkE,cAAAA,SAAS,CAAClE,IAAV,GAAiB,CAAjB;AACA,qBAAOtB,QAAQ,CAACK,OAAT,CAAiByD,eAAjB,EAAP;;AAEF,iBAAK,CAAL;AACEF,cAAAA,IAAI,GAAG4B,SAAS,CAACvC,IAAjB;AACAmC,cAAAA,QAAQ,GAAG,EAAX;AACAC,cAAAA,SAAS,GAAGpF,0BAA0B,CAAC2D,IAAD,CAAtC;;AAEA,kBAAI;AACF,qBAAKyB,SAAS,CAAC3E,CAAV,EAAL,EAAoB,CAAC,CAAC4E,KAAK,GAAGD,SAAS,CAAC1E,CAAV,EAAT,EAAwBC,IAA7C,GAAoD;AAClDsD,kBAAAA,GAAG,GAAGoB,KAAK,CAACzE,KAAZ;;AAEA,sBAAI,CAAC,GAAGd,oBAAoB,CAACsE,mBAAzB,EAA8CH,GAA9C,CAAJ,EAAwD;AACtDkB,oBAAAA,QAAQ,CAACK,IAAT,CAAcvB,GAAd;AACD;AACF;AACF,eARD,CAQE,OAAO9C,GAAP,EAAY;AACZiE,gBAAAA,SAAS,CAACvE,CAAV,CAAYM,GAAZ;AACD,eAVD,SAUU;AACRiE,gBAAAA,SAAS,CAACrE,CAAV;AACD;;AAEDuE,cAAAA,QAAQ,GAAG,CAAC,GAAG9F,IAAI,CAACY,OAAT,EAAkB+E,QAAlB,EAA4BrD,IAA5B,CAAiCqD,QAAjC,EAA2CF,KAAK,CAAC1B,aAAjD,CAAX;AACA,qBAAOgC,SAAS,CAACtC,MAAV,CAAiB,QAAjB,EAA2BxD,QAAQ,CAACW,OAAT,CAAiBqF,GAAjB,CAAqBH,QAArB,CAA3B,CAAP;;AAEF,iBAAK,CAAL;AACA,iBAAK,KAAL;AACE,qBAAOC,SAAS,CAACnC,IAAV,EAAP;AA7BJ;AA+BD;AACF,OAlCM,EAkCJ8B,QAlCI,CAAP;AAmCD,KAtCoD,CAA9C,GAAP;AAuCD;AA1N4B,CAA/B;AA4NAQ,MAAM,CAACC,OAAP,GAAiBrD,wBAAjB","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime-corejs3/helpers/interopRequireDefault\");\n\nvar _getIterator2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js/get-iterator\"));\n\nvar _isArray = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/array/is-array\"));\n\nvar _getIteratorMethod2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js/get-iterator-method\"));\n\nvar _symbol = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/symbol\"));\n\nvar _from = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/array/from\"));\n\nvar _slice = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/slice\"));\n\nvar _map = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/map\"));\n\nvar _promise = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/promise\"));\n\nvar _reduce = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/reduce\"));\n\nvar _stringify = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/json/stringify\"));\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime-corejs3/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/asyncToGenerator\"));\n\nvar _LocalDatastoreUtils = require(\"./LocalDatastoreUtils\");\n\nvar _Storage = _interopRequireDefault(require(\"./Storage\"));\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) {\n  var it;\n\n  if (typeof _symbol.default === \"undefined\" || (0, _getIteratorMethod2.default)(o) == null) {\n    if ((0, _isArray.default)(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n\n      var F = function () {};\n\n      return {\n        s: F,\n        n: function () {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function (_e) {\n          throw _e;\n        },\n        f: F\n      };\n    }\n\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n\n  var normalCompletion = true,\n      didErr = false,\n      err;\n  return {\n    s: function () {\n      it = (0, _getIterator2.default)(o);\n    },\n    n: function () {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function (_e2) {\n      didErr = true;\n      err = _e2;\n    },\n    f: function () {\n      try {\n        if (!normalCompletion && it.return != null) it.return();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  var _context7;\n\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = (0, _slice.default)(_context7 = Object.prototype.toString.call(o)).call(_context7, 8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return (0, _from.default)(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nvar LocalDatastoreController = {\n  fromPinWithName: function (name\n  /*: string*/\n  )\n  /*: Array<Object>*/\n  {\n    return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee() {\n      var values, objects;\n      return _regenerator.default.wrap(function (_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _Storage.default.getItemAsync(name);\n\n            case 2:\n              values = _context.sent;\n\n              if (values) {\n                _context.next = 5;\n                break;\n              }\n\n              return _context.abrupt(\"return\", []);\n\n            case 5:\n              objects = JSON.parse(values);\n              return _context.abrupt(\"return\", objects);\n\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }))();\n  },\n  pinWithName: function (name\n  /*: string*/\n  , value\n  /*: any*/\n  ) {\n    var values = (0, _stringify.default)(value);\n    return _Storage.default.setItemAsync(name, values);\n  },\n  unPinWithName: function (name\n  /*: string*/\n  ) {\n    return _Storage.default.removeItemAsync(name);\n  },\n  getAllContents: function ()\n  /*: Object*/\n  {\n    return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee3() {\n      var keys;\n      return _regenerator.default.wrap(function (_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return _Storage.default.getAllKeysAsync();\n\n            case 2:\n              keys = _context3.sent;\n              return _context3.abrupt(\"return\", (0, _reduce.default)(keys).call(keys, /*#__PURE__*/function () {\n                var _ref = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee2(previousPromise, key) {\n                  var LDS, value;\n                  return _regenerator.default.wrap(function (_context2) {\n                    while (1) {\n                      switch (_context2.prev = _context2.next) {\n                        case 0:\n                          _context2.next = 2;\n                          return previousPromise;\n\n                        case 2:\n                          LDS = _context2.sent;\n\n                          if (!(0, _LocalDatastoreUtils.isLocalDatastoreKey)(key)) {\n                            _context2.next = 8;\n                            break;\n                          }\n\n                          _context2.next = 6;\n                          return _Storage.default.getItemAsync(key);\n\n                        case 6:\n                          value = _context2.sent;\n\n                          try {\n                            LDS[key] = JSON.parse(value);\n                          } catch (error) {\n                            console.error('Error getAllContents: ', error);\n                          }\n\n                        case 8:\n                          return _context2.abrupt(\"return\", LDS);\n\n                        case 9:\n                        case \"end\":\n                          return _context2.stop();\n                      }\n                    }\n                  }, _callee2);\n                }));\n\n                return function () {\n                  return _ref.apply(this, arguments);\n                };\n              }(), _promise.default.resolve({})));\n\n            case 4:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }))();\n  },\n  // Used for testing\n  getRawStorage: function ()\n  /*: Object*/\n  {\n    return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee5() {\n      var keys;\n      return _regenerator.default.wrap(function (_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.next = 2;\n              return _Storage.default.getAllKeysAsync();\n\n            case 2:\n              keys = _context5.sent;\n              return _context5.abrupt(\"return\", (0, _reduce.default)(keys).call(keys, /*#__PURE__*/function () {\n                var _ref2 = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee4(previousPromise, key) {\n                  var LDS, value;\n                  return _regenerator.default.wrap(function (_context4) {\n                    while (1) {\n                      switch (_context4.prev = _context4.next) {\n                        case 0:\n                          _context4.next = 2;\n                          return previousPromise;\n\n                        case 2:\n                          LDS = _context4.sent;\n                          _context4.next = 5;\n                          return _Storage.default.getItemAsync(key);\n\n                        case 5:\n                          value = _context4.sent;\n                          LDS[key] = value;\n                          return _context4.abrupt(\"return\", LDS);\n\n                        case 8:\n                        case \"end\":\n                          return _context4.stop();\n                      }\n                    }\n                  }, _callee4);\n                }));\n\n                return function () {\n                  return _ref2.apply(this, arguments);\n                };\n              }(), _promise.default.resolve({})));\n\n            case 4:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5);\n    }))();\n  },\n  clear: function ()\n  /*: Promise*/\n  {\n    var _this = this;\n\n    return (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee6() {\n      var keys, toRemove, _iterator, _step, key, promises;\n\n      return _regenerator.default.wrap(function (_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              _context6.next = 2;\n              return _Storage.default.getAllKeysAsync();\n\n            case 2:\n              keys = _context6.sent;\n              toRemove = [];\n              _iterator = _createForOfIteratorHelper(keys);\n\n              try {\n                for (_iterator.s(); !(_step = _iterator.n()).done;) {\n                  key = _step.value;\n\n                  if ((0, _LocalDatastoreUtils.isLocalDatastoreKey)(key)) {\n                    toRemove.push(key);\n                  }\n                }\n              } catch (err) {\n                _iterator.e(err);\n              } finally {\n                _iterator.f();\n              }\n\n              promises = (0, _map.default)(toRemove).call(toRemove, _this.unPinWithName);\n              return _context6.abrupt(\"return\", _promise.default.all(promises));\n\n            case 8:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, _callee6);\n    }))();\n  }\n};\nmodule.exports = LocalDatastoreController;"]},"metadata":{},"sourceType":"script"}